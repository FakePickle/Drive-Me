<app-admin-navbar></app-admin-navbar>
<div class="admin-container">
  
    <div class="admin-content">
      <div class="admin-tabs">
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'users'" 
          (click)="switchTab('users')">
          Users
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'drivers'" 
          (click)="switchTab('drivers')">
          Drivers
        </button>
      </div>
  
      <div class="tab-content">
        <!-- Search & Action Bar -->
        <div class="action-bar">
          <div class="search-container">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Search by name, email or phone..." 
              [(ngModel)]="searchTerm" 
              (input)="searchUsers()">
          </div>
          <button 
            class="btn btn-primary" 
            (click)="activeTab === 'users' ? addNewUser() : addNewDriver()">
            <span class="plus-icon">+</span> 
            Add New {{ activeTab === 'users' ? 'User' : 'Driver' }}
          </button>
        </div>
  
        <!-- Users Table -->
        <div class="table-container" *ngIf="activeTab === 'users'">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Join Date</th>
                <th>Bookings</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of filteredUsers">
                <td>{{ user.id }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.phone }}</td>
                <td>{{ user.joinDate }}</td>
                <td>{{ user.bookingsCount }}</td>
                <td><span class="status-badge" [class]="getStatusClass(user.status)">{{ user.status }}</span></td>
                <td class="actions">
                  <button class="action-btn edit" (click)="editUser(user)" title="Edit User">
                    <span class="action-icon">‚úèÔ∏è</span>
                  </button>
                  <button class="action-btn delete" (click)="confirmDelete('user', user.id)" title="Delete User">
                    <span class="action-icon">üóëÔ∏è</span>
                  </button>
                </td>
              </tr>
              <tr *ngIf="filteredUsers.length === 0">
                <td colspan="8" class="no-data">No users found. Try a different search term or add a new user.</td>
              </tr>
            </tbody>
          </table>
        </div>
  
        <!-- Drivers Table -->
        <div class="table-container" *ngIf="activeTab === 'drivers'">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Rating</th>
                <th>Experience</th>
                <th>Rate/hr</th>
                <th>Trips</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let driver of filteredDrivers">
                <td>{{ driver.id }}</td>
                <td>{{ driver.name }}</td>
                <td>{{ driver.email }}</td>
                <td>{{ driver.phone }}</td>
                <td class="rating">{{ driver.rating }} ‚≠ê</td>
                <td>{{ driver.experience }} years</td>
                <td>${{ driver.hourlyRate }}</td>
                <td>{{ driver.totalTrips }}</td>
                <td><span class="status-badge" [class]="getStatusClass(driver.status)">{{ driver.status }}</span></td>
                <td class="actions">
                  <button class="action-btn edit" (click)="editDriver(driver)" title="Edit Driver">
                    <span class="action-icon">‚úèÔ∏è</span>
                  </button>
                  <button class="action-btn delete" (click)="confirmDelete('driver', driver.id)" title="Delete Driver">
                    <span class="action-icon">üóëÔ∏è</span>
                  </button>
                </td>
              </tr>
              <tr *ngIf="filteredDrivers.length === 0">
                <td colspan="10" class="no-data">No drivers found. Try a different search term or add a new driver.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  
    <!-- User Edit/Add Modal -->
    <div class="modal-backdrop" *ngIf="showUserModal" (click)="closeUserModal()"></div>
    <div class="modal" *ngIf="showUserModal">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Edit User' : 'Add New User' }}</h2>
        <button class="close-btn" (click)="closeUserModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form [formGroup]="userForm" (ngSubmit)="saveUser()">
          <div class="form-group">
            <label for="userName">Name</label>
            <input type="text" id="userName" class="form-control" formControlName="name">
            <div class="error-message" *ngIf="userForm.get('name')?.touched && userForm.get('name')?.errors?.['required']">
              Name is required
            </div>
          </div>
          
          <div class="form-group">
            <label for="userEmail">Email</label>
            <input type="email" id="userEmail" class="form-control" formControlName="email">
            <div class="error-message" *ngIf="userForm.get('email')?.touched && userForm.get('email')?.errors?.['required']">
              Email is required
            </div>
            <div class="error-message" *ngIf="userForm.get('email')?.touched && userForm.get('email')?.errors?.['email']">
              Please enter a valid email
            </div>
          </div>
          
          <div class="form-group">
            <label for="userPhone">Phone (Format: 555-123-4567)</label>
            <input type="text" id="userPhone" class="form-control" formControlName="phone">
            <div class="error-message" *ngIf="userForm.get('phone')?.touched && userForm.get('phone')?.errors?.['required']">
              Phone is required
            </div>
            <div class="error-message" *ngIf="userForm.get('phone')?.touched && userForm.get('phone')?.errors?.['pattern']">
              Please use format: 555-123-4567
            </div>
          </div>
          
          <div class="form-group">
            <label for="userStatus">Status</label>
            <select id="userStatus" class="form-control" formControlName="status">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="closeUserModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">Save User</button>
          </div>
        </form>
      </div>
    </div>
  
    <!-- Driver Edit/Add Modal -->
    <div class="modal-backdrop" *ngIf="showDriverModal" (click)="closeDriverModal()"></div>
    <div class="modal" *ngIf="showDriverModal">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Edit Driver' : 'Add New Driver' }}</h2>
        <button class="close-btn" (click)="closeDriverModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form [formGroup]="driverForm" (ngSubmit)="saveDriver()">
          <div class="form-row">
            <div class="form-group">
              <label for="driverName">Name</label>
              <input type="text" id="driverName" class="form-control" formControlName="name">
              <div class="error-message" *ngIf="driverForm.get('name')?.touched && driverForm.get('name')?.errors?.['required']">
                Name is required
              </div>
            </div>
            
            <div class="form-group">
              <label for="driverEmail">Email</label>
              <input type="email" id="driverEmail" class="form-control" formControlName="email">
              <div class="error-message" *ngIf="driverForm.get('email')?.touched && driverForm.get('email')?.errors?.['required']">
                Email is required
              </div>
              <div class="error-message" *ngIf="driverForm.get('email')?.touched && driverForm.get('email')?.errors?.['email']">
                Please enter a valid email
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="driverPhone">Phone (Format: 555-123-4567)</label>
              <input type="text" id="driverPhone" class="form-control" formControlName="phone">
              <div class="error-message" *ngIf="driverForm.get('phone')?.touched && driverForm.get('phone')?.errors?.['required']">
                Phone is required
              </div>
              <div class="error-message" *ngIf="driverForm.get('phone')?.touched && driverForm.get('phone')?.errors?.['pattern']">
                Please use format: 555-123-4567
              </div>
            </div>
            
            <div class="form-group">
              <label for="driverStatus">Status</label>
              <select id="driverStatus" class="form-control" formControlName="status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="driverExperience">Experience (years)</label>
              <input type="number" id="driverExperience" class="form-control" formControlName="experience" min="0">
              <div class="error-message" *ngIf="driverForm.get('experience')?.touched && driverForm.get('experience')?.errors?.['required']">
                Experience is required
              </div>
            </div>
            
            <div class="form-group">
              <label for="driverRate">Hourly Rate ($)</label>
              <input type="number" id="driverRate" class="form-control" formControlName="hourlyRate" min="0">
              <div class="error-message" *ngIf="driverForm.get('hourlyRate')?.touched && driverForm.get('hourlyRate')?.errors?.['required']">
                Hourly rate is required
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="driverLicense">License Number</label>
              <input type="text" id="driverLicense" class="form-control" formControlName="licenseNumber">
              <div class="error-message" *ngIf="driverForm.get('licenseNumber')?.touched && driverForm.get('licenseNumber')?.errors?.['required']">
                License number is required
              </div>
            </div>
            
            <div class="form-group">
              <label for="driverVehicle">Vehicle Information</label>
              <input type="text" id="driverVehicle" class="form-control" formControlName="vehicleInfo">
              <div class="error-message" *ngIf="driverForm.get('vehicleInfo')?.touched && driverForm.get('vehicleInfo')?.errors?.['required']">
                Vehicle information is required
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="driverSpecialties">Specialties (comma separated)</label>
            <input type="text" id="driverSpecialties" class="form-control" formControlName="specialties" placeholder="Long Distance, Night Driving, etc.">
            <div class="error-message" *ngIf="driverForm.get('specialties')?.touched && driverForm.get('specialties')?.errors?.['required']">
              At least one specialty is required
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="closeDriverModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Driver</button>
          </div>
        </form>
      </div>
    </div>
  
    <div class="modal-backdrop" *ngIf="confirmDeleteModal" (click)="closeDeleteModal()"></div>
    <div class="modal delete-modal" *ngIf="confirmDeleteModal">
      <div class="modal-header">
        <h2>Confirm Delete</h2>
        <button class="close-btn" (click)="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this {{ entityToDelete?.type }}? This action cannot be undone.</p>
        <div class="form-actions delete-actions">
          <button class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
          <button class="btn btn-danger" (click)="deleteEntity()">Delete</button>
        </div>
      </div>
    </div>
  </div>