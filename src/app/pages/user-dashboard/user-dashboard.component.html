<app-navbar></app-navbar>

<div class="dashboard-container">
  <app-sidebar [menuItems]="sidebarMenuItems"></app-sidebar>
  
  <main class="dashboard-content">
    <div class="welcome-section">
      <h1>Welcome, {{userName}}!</h1>
      <p class="subtitle">Here's an overview of your current rides and activity</p>
    </div>
    
    <!-- Loading and Error Messages -->
    <div *ngIf="isLoading" class="loading-indicator">
      <div class="spinner"></div>
      <p>Loading your bookings...</p>
    </div>
    
    <div *ngIf="errorMessage" class="error-alert">
      <p><i class="fas fa-exclamation-triangle"></i> {{errorMessage}}</p>
      <button class="btn btn-secondary" (click)="errorMessage = ''">Dismiss</button>
    </div>
    
    <!-- Stats Cards -->
    <div class="stats-container">
      <div class="stat-card" *ngFor="let stat of stats">
        <div class="stat-icon">{{stat.icon}}</div>
        <div class="stat-info">
          <p class="stat-value">{{stat.value}}</p>
          <p class="stat-title">{{stat.title}}</p>
        </div>
      </div>
    </div>
    
    <!-- Bookings Section -->
    <div class="bookings-section">
      <div class="section-header">
        <h2>My Bookings</h2>
        <a routerLink="/driver-booking" class="btn btn-primary">Book a Driver</a>
      </div>
      
      <!-- Booking Tabs -->
      <div class="booking-tabs">
        <button 
          [class.active]="activeTab === 'upcoming'" 
          (click)="setActiveTab('upcoming')">
          Upcoming ({{upcomingBookings.length}})
        </button>
        <button 
          [class.active]="activeTab === 'past'" 
          (click)="setActiveTab('past')">
          Past ({{pastBookings.length}})
        </button>
        <button 
          [class.active]="activeTab === 'all'" 
          (click)="setActiveTab('all')">
          All ({{allBookings.length}})
        </button>
      </div>
      
      <!-- No Bookings Message -->
      <div *ngIf="(activeTab === 'upcoming' && upcomingBookings.length === 0) || 
                  (activeTab === 'past' && pastBookings.length === 0) || 
                  (activeTab === 'all' && allBookings.length === 0)" 
           class="no-bookings">
        <p>No bookings to display</p>
        <a routerLink="/driver-booking" class="btn btn-primary">Book Your First Trip</a>
      </div>
      
      <!-- Bookings List -->
      <div class="bookings-list">
        <!-- For Upcoming Tab -->
        <div *ngIf="activeTab === 'upcoming'">
          <div *ngFor="let booking of upcomingBookings" class="booking-card">
            <div class="booking-main">
              <div class="booking-icon">ðŸš•</div>
              <div class="booking-details">
                <div class="booking-id">Booking #{{booking.bookingId}}</div>
                <h3 class="booking-title">{{booking.pickupLocation}} â†’ {{booking.dropoffLocation}}</h3>
                <p class="booking-time">{{formatDate(booking.createdAt)}}</p>
                <p class="booking-driver" *ngIf="booking.driverName">Driver: {{booking.driverName}}</p>
              </div>
            </div>
            <div class="booking-status">
              <span [style.color]="getStatusColor(booking.status)" class="status-badge">
                <span class="status-icon">{{getStatusIcon(booking.status)}}</span>
                {{booking.status}}
              </span>
              <div class="booking-price">${{booking.fare}}</div>
              <button 
                *ngIf="booking.status === 'PENDING' || booking.status === 'CONFIRMED'" 
                class="btn btn-cancel"
                (click)="cancelBooking(booking.bookingId)">
                Cancel
              </button>
            </div>
          </div>
        </div>
        
        <!-- For Past Tab -->
        <div *ngIf="activeTab === 'past'">
          <div *ngFor="let booking of pastBookings" class="booking-card">
            <div class="booking-main">
              <div class="booking-icon">ðŸš•</div>
              <div class="booking-details">
                <div class="booking-id">Booking #{{booking.bookingId}}</div>
                <h3 class="booking-title">{{booking.pickupLocation}} â†’ {{booking.dropoffLocation}}</h3>
                <p class="booking-time">{{formatDate(booking.createdAt)}}</p>
                <p class="booking-driver" *ngIf="booking.driverName">Driver: {{booking.driverName}}</p>
              </div>
            </div>
            <div class="booking-status">
              <span [style.color]="getStatusColor(booking.status)" class="status-badge">
                <span class="status-icon">{{getStatusIcon(booking.status)}}</span>
                {{booking.status}}
              </span>
              <div class="booking-price">${{booking.fare}}</div>
              <button 
                *ngIf="booking.status === 'COMPLETED'" 
                class="btn btn-review">
                Leave Review
              </button>
            </div>
          </div>
        </div>
        
        <!-- For All Tab -->
        <div *ngIf="activeTab === 'all'">
          <div *ngFor="let booking of allBookings" class="booking-card">
            <div class="booking-main">
              <div class="booking-icon">ðŸš•</div>
              <div class="booking-details">
                <div class="booking-id">Booking #{{booking.bookingId}}</div>
                <h3 class="booking-title">{{booking.pickupLocation}} â†’ {{booking.dropoffLocation}}</h3>
                <p class="booking-time">{{formatDate(booking.createdAt)}}</p>
                <p class="booking-driver" *ngIf="booking.driverName">Driver: {{booking.driverName}}</p>
              </div>
            </div>
            <div class="booking-status">
              <span [style.color]="getStatusColor(booking.status)" class="status-badge">
                <span class="status-icon">{{getStatusIcon(booking.status)}}</span>
                {{booking.status}}
              </span>
              <div class="booking-price">${{booking.fare}}</div>
              <button 
                *ngIf="booking.status === 'PENDING' || booking.status === 'CONFIRMED'" 
                class="btn btn-cancel"
                (click)="cancelBooking(booking.bookingId)">
                Cancel
              </button>
              <button 
                *ngIf="booking.status === 'COMPLETED'" 
                class="btn btn-review">
                Review
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Other Dashboard Sections -->
    <div class="dashboard-grid">
      <!-- Top Drivers Section -->
      <div class="dashboard-card">
        <h2>Top Rated Drivers</h2>
        <div class="top-drivers">
          <div class="driver-item" *ngFor="let driver of topDrivers">
            <div class="driver-icon">{{driver.icon}}</div>
            <div class="driver-info">
              <div class="driver-name">{{driver.name}}</div>
              <div class="driver-experience">{{driver.experience}}</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Recent Activity Section -->
      <div class="dashboard-card">
        <h2>Recent Activity</h2>
        <div class="activity-list">
          <div class="activity-item" *ngFor="let activity of recentActivities">
            <div class="activity-icon">{{activity.icon}}</div>
            <div class="activity-info">
              <div class="activity-title">{{activity.title}}</div>
              <div class="activity-details">{{activity.details}}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>